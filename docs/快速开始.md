# 快速开始指南

## 环境要求

- **Python**: 3.9+
- **Node.js**: 18+
- **MySQL**: 8.0+
- **Docker** (可选): 用于容器化部署

---

## 方式一：本地开发环境

### 1. 启动 MySQL 数据库

如果已有 MySQL，创建数据库：

```sql
CREATE DATABASE word_editor CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

或使用 Docker 启动：

```bash
docker run -d \
  --name word_editor_mysql \
  -e MYSQL_ROOT_PASSWORD=password \
  -e MYSQL_DATABASE=word_editor \
  -p 3306:3306 \
  mysql:8.0
```

### 2. 配置后端

进入后端目录：

```bash
cd new_pro/backend
```

创建虚拟环境：

```bash
python -m venv venv

# Windows
venv\Scripts\activate

# Linux/Mac
source venv/bin/activate
```

安装依赖：

```bash
pip install -r requirements.txt
```

配置环境变量：

```bash
# 复制示例配置
cp .env.example .env

# 编辑 .env 文件，修改数据库连接
# DATABASE_URL=mysql+pymysql://root:password@localhost:3306/word_editor
```

启动后端服务：

```bash
# 开发模式（自动重载）
uvicorn app.main:app --reload

# 或直接运行
python -m app.main
```

访问 API 文档：
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

### 3. 配置前端

进入前端目录：

```bash
cd new_pro/frontend
```

安装依赖：

```bash
npm install
```

启动开发服务器：

```bash
npm run dev
```

访问前端：http://localhost:5173

---

## 方式二：Docker Compose 一键启动

### 1. 启动所有服务

在项目根目录执行：

```bash
cd new_pro
docker-compose up -d
```

这将自动启动：
- MySQL 数据库（端口 3306）
- 后端 API（端口 8000）
- 前端应用（端口 5173）

### 2. 查看日志

```bash
# 查看所有服务日志
docker-compose logs -f

# 查看特定服务日志
docker-compose logs -f backend
```

### 3. 停止服务

```bash
docker-compose down
```

---

## 使用示例

### 1. 创建文档

```bash
curl -X POST http://localhost:8000/api/v1/documents \
  -H "Content-Type: application/json" \
  -d '{"title": "我的第一个文档"}'
```

响应：
```json
{
  "id": "abc-123-def",
  "title": "我的第一个文档",
  "created_at": "2026-01-02T12:00:00",
  "updated_at": "2026-01-02T12:00:00"
}
```

### 2. 创建章节

```bash
curl -X POST http://localhost:8000/api/v1/chapters \
  -H "Content-Type: application/json" \
  -d '{
    "doc_id": "abc-123-def",
    "title": "第一章",
    "html_content": "<p>这是<strong>第一章</strong>的内容</p>",
    "order_index": 0
  }'
```

### 3. 获取章节（返回渲染后的 HTML）

```bash
curl http://localhost:8000/api/v1/chapters/{chapter_id}
```

### 4. 导出为 Word

在浏览器中访问：
```
http://localhost:8000/api/v1/export/chapters/{chapter_id}/docx
```

---

## 前端使用示例

```tsx
import React from 'react';
import EditorComponent from './components/Editor';

function App() {
  const docId = 'your-document-id';

  return (
    <div>
      <h1>Web Word Editor</h1>
      <EditorComponent 
        docId={docId}
        onSave={() => console.log('保存成功')}
      />
    </div>
  );
}

export default App;
```

---

## 核心工作流程

### 保存流程

```
用户编辑 → WangEditor 生成 HTML → 前端发送 HTML 到后端
                                              ↓
                                    后端 HtmlParser 解析
                                              ↓
                              Content JSON + StyleSheet JSON
                                              ↓
                                        保存到 MySQL
```

### 加载流程

```
前端请求章节 → 后端从数据库读取 Content + StyleSheet
                              ↓
                    后端 HtmlRenderer 渲染
                              ↓
                        生成 HTML 返回
                              ↓
                    前端 WangEditor 展示
```

---

## 常见问题

### 1. 数据库连接失败

检查 `.env` 文件中的 `DATABASE_URL` 是否正确。

### 2. 前端无法访问后端

检查 CORS 配置，确保 `app/core/config.py` 中的 `CORS_ORIGINS` 包含前端地址。

### 3. 表格合并单元格显示异常

确保 HTML 中的 `rowspan` 和 `colspan` 属性正确，后端会自动解析。

---

## 下一步

- 查看 [API 文档](./api.md) 了解详细接口
- 查看 [架构设计](./architecture.md) 了解系统设计
- 阅读源码中的注释（注释覆盖率 >30%）
