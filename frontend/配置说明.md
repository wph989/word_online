# 前端配置说明

## 环境变量配置

前端使用 Vite 的环境变量系统，支持通过 `.env` 文件配置。

### 配置文件

#### `.env` - 默认配置（所有环境）
```bash
# 前端开发服务器配置
VITE_HOST=0.0.0.0
VITE_PORT=5173

# 后端 API 地址
VITE_API_BASE_URL=http://localhost:8000
```

#### `.env.local` - 本地开发配置（优先级更高，不会提交到 Git）
```bash
# 本地开发时可以覆盖默认配置
VITE_API_BASE_URL=http://192.168.1.100:8000
```

#### `.env.production` - 生产环境配置
```bash
VITE_API_BASE_URL=https://api.yourdomain.com
```

### 配置项说明

| 配置项 | 说明 | 默认值 | 示例 |
|--------|------|--------|------|
| `VITE_HOST` | 前端服务器监听地址 | `0.0.0.0` | `localhost`, `0.0.0.0` |
| `VITE_PORT` | 前端服务器端口 | `5173` | `5173`, `3000` |
| `VITE_API_BASE_URL` | 后端 API 基础地址 | `http://localhost:8000` | `http://192.168.1.100:8000` |

### 使用方法

#### 1. 开发环境

```bash
# 复制示例配置
cp .env.example .env

# 编辑配置（可选）
# 修改 .env 文件中的配置项

# 启动开发服务器
npm run dev
```

开发服务器会自动读取 `.env` 文件中的配置。

#### 2. 生产环境

```bash
# 创建生产环境配置
cat > .env.production << EOF
VITE_API_BASE_URL=https://api.yourdomain.com
EOF

# 构建生产版本
npm run build
```

### 在代码中使用环境变量

```typescript
// 读取环境变量
const apiUrl = import.meta.env.VITE_API_BASE_URL;
const host = import.meta.env.VITE_HOST;
const port = import.meta.env.VITE_PORT;

// 示例：在 API 服务中使用
const api = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || 'http://localhost:8000'
});
```

### TypeScript 类型支持

环境变量的类型定义在 `src/vite-env.d.ts` 中：

```typescript
interface ImportMetaEnv {
  readonly VITE_HOST: string
  readonly VITE_PORT: string
  readonly VITE_API_BASE_URL: string
}
```

这样可以在 IDE 中获得自动补全和类型检查。

### 常见场景

#### 场景 1：本地开发，后端在同一台机器
```bash
# .env
VITE_API_BASE_URL=http://localhost:8000
```

#### 场景 2：本地开发，后端在其他机器
```bash
# .env.local
VITE_API_BASE_URL=http://192.168.1.100:8000
```

#### 场景 3：使用代理（避免跨域）
```bash
# .env
VITE_API_BASE_URL=/api
```

然后在 `vite.config.ts` 中配置代理：
```typescript
export default defineConfig({
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '')
      }
    }
  }
})
```

#### 场景 4：生产部署
```bash
# .env.production
VITE_API_BASE_URL=https://api.yourdomain.com
```

### 注意事项

1. **环境变量必须以 `VITE_` 开头**
   - Vite 只会暴露以 `VITE_` 开头的环境变量
   - 这是为了防止意外暴露敏感信息

2. **`.env.local` 不会提交到 Git**
   - 用于存储本地开发的个性化配置
   - 已在 `.gitignore` 中忽略

3. **优先级**
   ```
   .env.production.local > .env.production > .env.local > .env
   ```

4. **修改环境变量后需要重启开发服务器**
   ```bash
   # 停止服务器（Ctrl+C）
   # 重新启动
   npm run dev
   ```

### 调试

查看当前使用的环境变量：

```typescript
console.log('API Base URL:', import.meta.env.VITE_API_BASE_URL);
console.log('All env:', import.meta.env);
```

### 相关文件

- `vite.config.ts` - Vite 配置文件
- `src/vite-env.d.ts` - 环境变量类型定义
- `src/services/api.ts` - API 服务（使用环境变量）
- `.env.example` - 环境变量示例
- `.gitignore` - Git 忽略配置（包含 `.env.local`）
